image: apache/superset:{{ SUPERSET_TAG }}
  user: root
  volumes:
    - ../../env/plugins/oars/apps/superset/docker:/app/docker
    - ../../env/plugins/oars/apps/superset/pythonpath:/app/pythonpath
    - ../../env/plugins/oars/apps/superset/data:/app/data
    - ../../env/plugins/oars/apps/superset/superset_home:/app/superset_home
  {% if SUPERSET_EXTRA_DEV_VOLUMES %}
    {% for volume in SUPERSET_EXTRA_DEV_VOLUMES %}
    - {{ volume }}
    {% endfor %}
  {% endif %}
  restart: unless-stopped
  environment:
    DATABASE_DIALECT: {{ SUPERSET_DB_DIALECT }}
    DATABASE_HOST: {{ SUPERSET_DB_HOST }}
    DATABASE_PORT: {{ SUPERSET_DB_PORT }}
    DATABASE_DB: {{ SUPERSET_DB_NAME }}
    DATABASE_PASSWORD: {{ SUPERSET_DB_PASSWORD }}
    DATABASE_USER: {{ SUPERSET_DB_USERNAME }}
    OAUTH2_CLIENT_ID: {{ SUPERSET_OAUTH2_CLIENT_ID }}
    OAUTH2_CLIENT_SECRET: {{ SUPERSET_OAUTH2_CLIENT_SECRET }}
    SECRET_KEY: {{ SUPERSET_SECRET_KEY }}
    PYTHONPATH: /app/pythonpath:/app/docker/pythonpath_dev
    REDIS_HOST: {{ REDIS_HOST }}
    REDIS_PORT: {{ REDIS_PORT }}
    REDIS_PASSWORD: {{ REDIS_PASSWORD }}
    FLASK_ENV: production
    SUPERSET_ENV: production
    SUPERSET_HOST: {{ SUPERSET_HOST }}
    SUPERSET_PORT: {{ SUPERSET_PORT }}
    OAUTH2_ACCESS_TOKEN_PATH: "{{ SUPERSET_OAUTH2_ACCESS_TOKEN_PATH }}"
    OAUTH2_AUTHORIZE_PATH: "{{ SUPERSET_OAUTH2_AUTHORIZE_PATH }}"
    OPENEDX_COURSES_LIST_PATH: "{{ SUPERSET_OPENEDX_COURSES_LIST_PATH }}"
